# MAC 地址、IP 地址以及 ARP 协议

MAC 地址是以太网的 MAC 子层所使用的地址，属于数据链路层。

IP 地址是 TCP/IP 体系结构网际层所使用的地址。

ARP 协议属于 TCP/IP 体系结构的网际层，其作用是已知设备所分配到的 IP 地址，使用 ARP 协议可以通过该 lP 地址获取到设备的 MAC 地址。

## MAC 地址

当多台主机连接在同一个广播信道上，想要实现两个主机之间的通信，则每个主机都必须有一个唯一的标识，即一个数据链路层地址，在每个主机发送的帧中必须携带源地址和目的地址。由于这类地址用于媒体接入控制，因此也叫做 MAC 地址。

MAC地址一般被固化在网卡（网络适配器）的电可擦可编程只读存储器 EEPROM 中，因此 MAC 地址也被称为硬件地址；MAC 地址有时也被称为物理地址，这并不意味着 MAC 地址属于网络体系结构中的物理层！

一般情况下，用户主机会包含两个网络适配器：有线局域网适配器（有线网卡）和无线局域网适配器（无线网卡)。每个网络适配器都有一个全球唯一的 MAC 地址。而交换机和路由器往往拥有更多的网络接口，所以会拥有更多的 MAC 地址。严格来说，MAC 地址是对网络上各接口的唯一标识，而不是对网络上各设备的唯一标识。

<img :src="$withBase('/NetWork/MAC地址格式.png')" alt="MAC地址格式" />

> EUI-48总是会用完，目前更推荐使用 EUI-64。

单播是指只和单个目标对话，但是如果在总线中，所有主机仍然会收到该请求的广播形式数据报。多播也叫组播，具有自己的组 MAC 地址，指和组内所有成员对话。

为了防止被监听，现在大多数移动设备已经采用了随机 MAC 地址技术。

## IP 地址

IP 地址是因特网(Internet)上的主机和路由器所使用的地址，用于标识两部分信息：

- 网络编号：标识因特网上数以百万计的网络；
- 主机编号：标识同一网络上不同主机（或路由器各接口）。

MAC 地址并不具有区分多个网络的功能，所以一般两个地址要同时使用。用一个例子来说，IP 地址就好比出发点与终点，MAC 地址是整个路程中的所有中转站。

<img :src="$withBase('/NetWork/MAC与IP.png')" alt="MAC与IP" />

## ARP 协议（地址解析协议）

如果我们事先已经知道下一站接口的 IP 地址，但并不知道 MAC 地址，这时候就需要使用ARP 协议。ARP 协议使得我们可以通过 IP 地址找到其相应的 MAC 地址。

假设主机 B 想要给主机 C 发送数据包，但只知道 C 的 IP 地址而不知道 MAC 地址，那么 B 的数据链路层封装 MAC 帧时，无法填写目的 MAC 地址.于是 B 将 ARP 请求报文封装在 MAC 帧中（目的地址FF-FF-FF-FF-FF-FF-FF）,报文的内容为 B 的 IP 地址和 MAC 地址，想要查找 IP 为 XXX 对应的 MAC 地址。

当目的主机 C 接收到该报文并交由上层处理后，将构建一个 ARP 响应报文（单播）来告知 B 自己的 MAC 地址。B 接收到该响应报文后，便会将 C 的 IP 地址与 MAC 地址的对应关系记录到自己的 ARP 高速缓存表中。主机 B 现在可以给主机 C 发送之前想要发送的数据包了。需要注意的是，该条记录是动态的，也就是在生命周期到时候会自动删除，这是为了防止 IP 地址与 MAC 地址的关系发生改变。（静态类型一般手工设置，不同操作系统下的生命周期不同）。

> ARP 协议只能使用在一段链路上！同时，ARP 协议没有安全验证机制，存在 ARP 欺骗问题！